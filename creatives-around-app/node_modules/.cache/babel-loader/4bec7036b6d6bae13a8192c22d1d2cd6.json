{"ast":null,"code":"import _regeneratorRuntime from\"/home/karol/Projects/creatives/creatives-around-frontend/creatives-around-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/home/karol/Projects/creatives/creatives-around-frontend/creatives-around-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/home/karol/Projects/creatives/creatives-around-frontend/creatives-around-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/karol/Projects/creatives/creatives-around-frontend/creatives-around-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/karol/Projects/creatives/creatives-around-frontend/creatives-around-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";var DataService=/*#__PURE__*/function(){function DataService(app){_classCallCheck(this,DataService);this.app=app;this.app.state={user:null};this.setUp();}_createClass(DataService,[{key:\"setUp\",value:function(){var _setUp=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var user,location;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this.fetchUser();case 2:user=_context.sent;location=this.getLocation();if(location!==user.location){this.updateLocation(location);}this.app.setState(_objectSpread({},this.app.state,{user:user}));case 6:case\"end\":return _context.stop();}}},_callee,this);}));function setUp(){return _setUp.apply(this,arguments);}return setUp;}()},{key:\"fetchUser\",value:function(){var _fetchUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var response,user;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return fetch('/api/user');case 3:response=_context2.sent;_context2.next=6;return response.json();case 6:user=_context2.sent;return _context2.abrupt(\"return\",user);case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](0);console.log('not ok');case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[0,10]]);}));function fetchUser(){return _fetchUser.apply(this,arguments);}return fetchUser;}()},{key:\"createUser\",value:function(){var _createUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(user){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return fetch('/api/user',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify(user)});case 3:console.log('User successfuly created');_context3.next=9;break;case 6:_context3.prev=6;_context3.t0=_context3[\"catch\"](0);console.error(_context3.t0);case 9:case\"end\":return _context3.stop();}}},_callee3,null,[[0,6]]);}));function createUser(_x){return _createUser.apply(this,arguments);}return createUser;}()},{key:\"logout\",value:function(){var _logout=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return fetch('/api/auth/logout');case 3:window.location.reload();_context4.next=9;break;case 6:_context4.prev=6;_context4.t0=_context4[\"catch\"](0);console.error(_context4.t0);case 9:case\"end\":return _context4.stop();}}},_callee4,null,[[0,6]]);}));function logout(){return _logout.apply(this,arguments);}return logout;}()},{key:\"getLocation\",value:function(){var _getLocation=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:navigator.geolocation.getCurrentPosition(function(position){alert(position);});case 1:case\"end\":return _context5.stop();}}},_callee5);}));function getLocation(){return _getLocation.apply(this,arguments);}return getLocation;}()},{key:\"updateLocation\",value:function(){var _updateLocation=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:case\"end\":return _context6.stop();}}},_callee6);}));function updateLocation(){return _updateLocation.apply(this,arguments);}return updateLocation;}()},{key:\"data\",get:function get(){return this.app.state;},set:function set(newState){this.app.setState(newState);}}]);return DataService;}();export{DataService as default};","map":{"version":3,"sources":["/home/karol/Projects/creatives/creatives-around-frontend/creatives-around-app/src/context/DataService.js"],"names":["DataService","app","state","user","setUp","fetchUser","location","getLocation","updateLocation","setState","fetch","response","json","console","log","method","headers","body","JSON","stringify","error","window","reload","navigator","geolocation","getCurrentPosition","position","alert","newState"],"mappings":"i9BAAqBA,CAAAA,W,yBACnB,qBAAYC,GAAZ,CAAiB,mCACf,KAAKA,GAAL,CAAWA,GAAX,CACA,KAAKA,GAAL,CAASC,KAAT,CAAiB,CAAEC,IAAI,CAAE,IAAR,CAAjB,CACA,KAAKC,KAAL,GACD,C,sSAQoB,MAAKC,SAAL,E,QAAbF,I,eACAG,Q,CAAW,KAAKC,WAAL,E,CACjB,GAAID,QAAQ,GAAKH,IAAI,CAACG,QAAtB,CAAgC,CAC9B,KAAKE,cAAL,CAAoBF,QAApB,EACD,CACD,KAAKL,GAAL,CAASQ,QAAT,kBAAuB,KAAKR,GAAL,CAASC,KAAhC,EAAuCC,IAAI,CAAJA,IAAvC,I,ibAIyBO,CAAAA,KAAK,CAAC,WAAD,C,QAAtBC,Q,uCACaA,CAAAA,QAAQ,CAACC,IAAT,E,QAAbT,I,iDACCA,I,+DAEPU,OAAO,CAACC,GAAR,CAAY,QAAZ,E,2RAGaX,I,8JAEPO,CAAAA,KAAK,CAAC,WAAD,CAAc,CACvBK,MAAM,CAAE,MADe,CAEvBC,OAAO,CAAE,CACP,eAAgB,kBADT,CAFc,CAKvBC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAehB,IAAf,CALiB,CAAd,C,QAOXU,OAAO,CAACC,GAAR,CAAY,0BAAZ,E,kFAEAD,OAAO,CAACO,KAAR,e,obAKMV,CAAAA,KAAK,CAAC,kBAAD,C,QACXW,MAAM,CAACf,QAAP,CAAgBgB,MAAhB,G,kFAEAT,OAAO,CAACO,KAAR,e,wYAIFG,SAAS,CAACC,WAAV,CAAsBC,kBAAtB,CAAyC,SAACC,QAAD,CAAc,CACrDC,KAAK,CAACD,QAAD,CAAL,CACD,CAFD,E,qkBA9CS,CACT,MAAO,MAAKzB,GAAL,CAASC,KAAhB,CACD,C,kBACQ0B,Q,CAAU,CACjB,KAAK3B,GAAL,CAASQ,QAAT,CAAkBmB,QAAlB,EACD,C,kCAXkB5B,W","sourcesContent":["export default class DataService {\n  constructor(app) {\n    this.app = app;\n    this.app.state = { user: null };\n    this.setUp();\n  }\n  get data() {\n    return this.app.state;\n  }\n  set data(newState) {\n    this.app.setState(newState);\n  }\n  async setUp() {\n    const user = await this.fetchUser();\n    const location = this.getLocation();\n    if (location !== user.location) {\n      this.updateLocation(location);\n    }\n    this.app.setState({ ...this.app.state, user });\n  }\n  async fetchUser() {\n    try {\n      const response = await fetch('/api/user');\n      const user = await response.json();\n      return user;\n    } catch (error) {\n      console.log('not ok');\n    }\n  }\n  async createUser(user) {\n    try {\n      await fetch('/api/user', {\n        method: 'POST',\n        headers: {\n          'content-type': 'application/json',\n        },\n        body: JSON.stringify(user),\n      });\n      console.log('User successfuly created');\n    } catch (error) {\n      console.error(error);\n    }\n  }\n  async logout() {\n    try {\n      await fetch('/api/auth/logout');\n      window.location.reload();\n    } catch (error) {\n      console.error(error);\n    }\n  }\n  async getLocation() {\n    navigator.geolocation.getCurrentPosition((position) => {\n      alert(position);\n    });\n  }\n  async updateLocation() {}\n}\n"]},"metadata":{},"sourceType":"module"}