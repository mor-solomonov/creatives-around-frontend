{"ast":null,"code":"import _regeneratorRuntime from\"/home/karol/Projects/creatives/creatives-around-frontend/creatives-around-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/home/karol/Projects/creatives/creatives-around-frontend/creatives-around-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/home/karol/Projects/creatives/creatives-around-frontend/creatives-around-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/karol/Projects/creatives/creatives-around-frontend/creatives-around-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/karol/Projects/creatives/creatives-around-frontend/creatives-around-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";var DataService=/*#__PURE__*/function(){function DataService(app){_classCallCheck(this,DataService);this.app=app;this.app.state={user:null};this.setUp();}_createClass(DataService,[{key:\"setUp\",// SETTING UP CONTEXT\nvalue:function(){var _setUp=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var user,location,sl;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this.fetchUser();case 2:user=_context.sent;if(user){_context.next=5;break;}return _context.abrupt(\"return\");case 5:_context.next=7;return this.getLocation();case 7:location=_context.sent;sl=JSON.stringify(location);console.log('Inside setup',sl);if(!(location!==user.location)){_context.next=13;break;}_context.next=13;return this.updateLocation(location);case 13:this.app.setState(_objectSpread({},this.app.state,{user:user}));case 14:case\"end\":return _context.stop();}}},_callee,this);}));function setUp(){return _setUp.apply(this,arguments);}return setUp;}()// FETCHIN LOGGED IN USER DATA\n},{key:\"fetchUser\",value:function(){var _fetchUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var response,user;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return fetch('/api/user');case 3:response=_context2.sent;_context2.next=6;return response.json();case 6:user=_context2.sent;return _context2.abrupt(\"return\",user);case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](0);console.log('not ok');case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[0,10]]);}));function fetchUser(){return _fetchUser.apply(this,arguments);}return fetchUser;}()// CREATING USER\n},{key:\"createUser\",value:function(){var _createUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(user){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return fetch('/api/user',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify(user)});case 3:console.log('User successfuly created');_context3.next=9;break;case 6:_context3.prev=6;_context3.t0=_context3[\"catch\"](0);console.error(_context3.t0);case 9:case\"end\":return _context3.stop();}}},_callee3,null,[[0,6]]);}));function createUser(_x){return _createUser.apply(this,arguments);}return createUser;}()// FETCHING ORHER USERS BASED ON FILTER\n},{key:\"getUsers\",value:function(){var _getUsers=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(filter){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return fetch('/api/user/all',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify(filter)});case 3:console.log('Fetching users based on the filter');_context4.next=9;break;case 6:_context4.prev=6;_context4.t0=_context4[\"catch\"](0);console.error(_context4.t0);case 9:case\"end\":return _context4.stop();}}},_callee4,null,[[0,6]]);}));function getUsers(_x2){return _getUsers.apply(this,arguments);}return getUsers;}()// LOGOUT\n},{key:\"logout\",value:function(){var _logout=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return fetch('/api/auth/logout');case 3:window.location.reload();_context5.next=9;break;case 6:_context5.prev=6;_context5.t0=_context5[\"catch\"](0);console.error(_context5.t0);case 9:case\"end\":return _context5.stop();}}},_callee5,null,[[0,6]]);}));function logout(){return _logout.apply(this,arguments);}return logout;}()// GET CURRENT LOCATION OF USER\n},{key:\"getLocation\",value:function(){var _getLocation=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:return _context6.abrupt(\"return\",new Promise(function(res,rej){navigator.geolocation.getCurrentPosition(function(position){return res(position);},function(err){rej(err);});}));case 1:case\"end\":return _context6.stop();}}},_callee6);}));function getLocation(){return _getLocation.apply(this,arguments);}return getLocation;}()// UPDATE LOCATION\n},{key:\"updateLocation\",value:function(){var _updateLocation=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(location){return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.prev=0;console.log('This should be location',location,JSON.stringify(location));_context7.next=4;return fetch('/api/user',{method:'PATCH',headers:{'content-type':'application/json'},body:location});case 4:_context7.next=9;break;case 6:_context7.prev=6;_context7.t0=_context7[\"catch\"](0);console.error(_context7.t0);case 9:case\"end\":return _context7.stop();}}},_callee7,null,[[0,6]]);}));function updateLocation(_x3){return _updateLocation.apply(this,arguments);}return updateLocation;}()},{key:\"data\",get:function get(){return this.app.state;},set:function set(newState){this.app.setState(newState);}}]);return DataService;}();export{DataService as default};","map":{"version":3,"sources":["/home/karol/Projects/creatives/creatives-around-frontend/creatives-around-app/src/context/DataService.js"],"names":["DataService","app","state","user","setUp","fetchUser","getLocation","location","sl","JSON","stringify","console","log","updateLocation","setState","fetch","response","json","method","headers","body","error","filter","window","reload","Promise","res","rej","navigator","geolocation","getCurrentPosition","position","err","newState"],"mappings":"i9BAAqBA,CAAAA,W,yBACnB,qBAAYC,GAAZ,CAAiB,mCACf,KAAKA,GAAL,CAAWA,GAAX,CACA,KAAKA,GAAL,CAASC,KAAT,CAAiB,CAAEC,IAAI,CAAE,IAAR,CAAjB,CACA,KAAKC,KAAL,GACD,C,uCAOD;kQAEqB,MAAKC,SAAL,E,QAAbF,I,kBACDA,I,uFAGkB,MAAKG,WAAL,E,QAAjBC,Q,eACAC,E,CAAKC,IAAI,CAACC,SAAL,CAAeH,QAAf,C,CACXI,OAAO,CAACC,GAAR,CAAY,cAAZ,CAA4BJ,EAA5B,E,KACID,QAAQ,GAAKJ,IAAI,CAACI,Q,kDACd,MAAKM,cAAL,CAAoBN,QAApB,C,SAER,KAAKN,GAAL,CAASa,QAAT,kBAAuB,KAAKb,GAAL,CAASC,KAAhC,EAAuCC,IAAI,CAAJA,IAAvC,I,qIAEF;6SAG2BY,CAAAA,KAAK,CAAC,WAAD,C,QAAtBC,Q,uCACaA,CAAAA,QAAQ,CAACC,IAAT,E,QAAbd,I,iDACCA,I,+DAEPQ,OAAO,CAACC,GAAR,CAAY,QAAZ,E,4JAGJ;+HACiBT,I,8JAEPY,CAAAA,KAAK,CAAC,WAAD,CAAc,CACvBG,MAAM,CAAE,MADe,CAEvBC,OAAO,CAAE,CACP,eAAgB,kBADT,CAFc,CAKvBC,IAAI,CAAEX,IAAI,CAACC,SAAL,CAAeP,IAAf,CALiB,CAAd,C,QAOXQ,OAAO,CAACC,GAAR,CAAY,0BAAZ,E,kFAEAD,OAAO,CAACU,KAAR,e,+JAGJ;2HACeC,M,8JAELP,CAAAA,KAAK,CAAC,eAAD,CAAkB,CAC3BG,MAAM,CAAE,MADmB,CAE3BC,OAAO,CAAE,CACP,eAAgB,kBADT,CAFkB,CAK3BC,IAAI,CAAEX,IAAI,CAACC,SAAL,CAAeY,MAAf,CALqB,CAAlB,C,QAOXX,OAAO,CAACC,GAAR,CAAY,oCAAZ,E,kFAEAD,OAAO,CAACU,KAAR,e,0JAGJ;qRAGUN,CAAAA,KAAK,CAAC,kBAAD,C,QACXQ,MAAM,CAAChB,QAAP,CAAgBiB,MAAhB,G,kFAEAb,OAAO,CAACU,KAAR,e,iJAGJ;wRAES,GAAII,CAAAA,OAAJ,CAAY,SAACC,GAAD,CAAMC,GAAN,CAAc,CAC/BC,SAAS,CAACC,WAAV,CAAsBC,kBAAtB,CACE,SAACC,QAAD,CAAc,CACZ,MAAOL,CAAAA,GAAG,CAACK,QAAD,CAAV,CACD,CAHH,CAIE,SAACC,GAAD,CAAS,CACPL,GAAG,CAACK,GAAD,CAAH,CACD,CANH,EAQD,CATM,C,qJAWT;uIACqBzB,Q,uIAEjBI,OAAO,CAACC,GAAR,CAAY,yBAAZ,CAAuCL,QAAvC,CAAiDE,IAAI,CAACC,SAAL,CAAeH,QAAf,CAAjD,E,uBACMQ,CAAAA,KAAK,CAAC,WAAD,CAAc,CACvBG,MAAM,CAAE,OADe,CAEvBC,OAAO,CAAE,CACP,eAAgB,kBADT,CAFc,CAKvBC,IAAI,CAAEb,QALiB,CAAd,C,0FAQXI,OAAO,CAACU,KAAR,e,4MA9FO,CACT,MAAO,MAAKpB,GAAL,CAASC,KAAhB,CACD,C,kBACQ+B,Q,CAAU,CACjB,KAAKhC,GAAL,CAASa,QAAT,CAAkBmB,QAAlB,EACD,C,kCAXkBjC,W","sourcesContent":["export default class DataService {\n  constructor(app) {\n    this.app = app;\n    this.app.state = { user: null };\n    this.setUp();\n  }\n  get data() {\n    return this.app.state;\n  }\n  set data(newState) {\n    this.app.setState(newState);\n  }\n  // SETTING UP CONTEXT\n  async setUp() {\n    const user = await this.fetchUser();\n    if (!user) {\n      return;\n    }\n    const location = await this.getLocation();\n    const sl = JSON.stringify(location);\n    console.log('Inside setup', sl);\n    if (location !== user.location) {\n      await this.updateLocation(location);\n    }\n    this.app.setState({ ...this.app.state, user });\n  }\n  // FETCHIN LOGGED IN USER DATA\n  async fetchUser() {\n    try {\n      const response = await fetch('/api/user');\n      const user = await response.json();\n      return user;\n    } catch (error) {\n      console.log('not ok');\n    }\n  }\n  // CREATING USER\n  async createUser(user) {\n    try {\n      await fetch('/api/user', {\n        method: 'POST',\n        headers: {\n          'content-type': 'application/json',\n        },\n        body: JSON.stringify(user),\n      });\n      console.log('User successfuly created');\n    } catch (error) {\n      console.error(error);\n    }\n  }\n  // FETCHING ORHER USERS BASED ON FILTER\n  async getUsers(filter) {\n    try {\n      await fetch('/api/user/all', {\n        method: 'POST',\n        headers: {\n          'content-type': 'application/json',\n        },\n        body: JSON.stringify(filter),\n      });\n      console.log('Fetching users based on the filter');\n    } catch (error) {\n      console.error(error);\n    }\n  }\n  // LOGOUT\n  async logout() {\n    try {\n      await fetch('/api/auth/logout');\n      window.location.reload();\n    } catch (error) {\n      console.error(error);\n    }\n  }\n  // GET CURRENT LOCATION OF USER\n  async getLocation() {\n    return new Promise((res, rej) => {\n      navigator.geolocation.getCurrentPosition(\n        (position) => {\n          return res(position);\n        },\n        (err) => {\n          rej(err);\n        }\n      );\n    });\n  }\n  // UPDATE LOCATION\n  async updateLocation(location) {\n    try {\n      console.log('This should be location', location, JSON.stringify(location));\n      await fetch('/api/user', {\n        method: 'PATCH',\n        headers: {\n          'content-type': 'application/json',\n        },\n        body: location,\n      });\n    } catch (error) {\n      console.error(error);\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}